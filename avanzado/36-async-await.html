<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>36 - Async / Await</title>
    <link rel="stylesheet" href="../fundamentos/styles.css">
</head>
<body>
    <a href="../basicos.html" class="back">‚Üê Volver al men√∫</a>
    <h1>36 - Async / Await</h1>
    
    <div class="code-section">
        <h2>üìå ¬øQu√© es Async/Await?</h2>
        <p>Sintaxis m√°s limpia para trabajar con Promises. Hace que el c√≥digo as√≠ncrono parezca s√≠ncrono.</p>
    </div>

    <h2>üíª Ejemplos Pr√°cticos</h2>
    <div id="ejemplos"></div>

    <script>
        let ejemploNumero = 0;
        const ejemplosContainer = document.getElementById('ejemplos');

        function iniciarEjemplo(titulo) {
            ejemploNumero++;
            const div = document.createElement('div');
            div.className = 'ejemplo-box';
            div.id = 'ejemplo-' + ejemploNumero;
            div.innerHTML = `<div class="ejemplo-header"><span class="ejemplo-numero">üìå EJEMPLO ${ejemploNumero}</span><span class="ejemplo-titulo">${titulo}</span></div><div class="ejemplo-contenido"></div>`;
            ejemplosContainer.appendChild(div);
        }

        function mostrar(texto) {
            const ejemploActual = document.getElementById('ejemplo-' + ejemploNumero);
            if (ejemploActual) {
                const contenido = ejemploActual.querySelector('.ejemplo-contenido');
                const linea = document.createElement('div');
                linea.style.cssText = 'color: #666; padding: 5px 0';
                linea.textContent = texto;
                contenido.appendChild(linea);
            }
        }

        function mostrarCodigo(codigo) {
            const ejemploActual = document.getElementById('ejemplo-' + ejemploNumero);
            if (ejemploActual) {
                const contenido = ejemploActual.querySelector('.ejemplo-contenido');
                const codigoDiv = document.createElement('div');
                codigoDiv.style.cssText = 'background: #282c34; color: #61dafb; padding: 12px; border-radius: 5px; font-family: Courier New; margin: 8px 0; border-left: 4px solid #f7df1e';
                codigoDiv.textContent = codigo;
                contenido.appendChild(codigoDiv);
            }
        }

        function mostrarResultado(texto) {
            const ejemploActual = document.getElementById('ejemplo-' + ejemploNumero);
            if (ejemploActual) {
                const contenido = ejemploActual.querySelector('.ejemplo-contenido');
                const linea = document.createElement('div');
                linea.style.cssText = 'color: #2ecc71; padding: 8px 15px; background: #e8f8f5; border-left: 4px solid #2ecc71; margin: 5px 0; border-radius: 3px; font-weight: 500; font-family: Courier New';
                linea.textContent = '‚ûú ' + texto;
                contenido.appendChild(linea);
            }
        }

        const style = document.createElement('style');
        style.textContent = `.ejemplo-box {background: white;border: 2px solid #f7df1e;border-radius: 8px;margin: 20px 0;overflow: hidden;box-shadow: 0 2px 8px rgba(0,0,0,0.1);}.ejemplo-header {background: linear-gradient(135deg, #f7df1e 0%, #e5ca00 100%);padding: 15px 20px;font-weight: bold;display: flex;align-items: center;gap: 15px;}.ejemplo-numero {background: #333;color: #f7df1e;padding: 5px 15px;border-radius: 20px;font-size: 0.9em;}.ejemplo-titulo {color: #333;font-size: 1.1em;}.ejemplo-contenido {padding: 20px;background: #f9f9f9;}`;
        document.head.appendChild(style);

        // EJEMPLO 1
        iniciarEjemplo("Funci√≥n async b√°sica");
        mostrarCodigo('async function saludar() {');
        mostrarCodigo('    return "Hola";');
        mostrarCodigo('}');
        mostrarCodigo('saludar().then(res => console.log(res));');
        async function saludar() {
            return "Hola";
        }
        saludar().then(res => mostrarResultado(res));
        mostrar('');
        mostrar('üí° async siempre retorna una Promise');

        // EJEMPLO 2
        iniciarEjemplo("await - Esperar una Promise");
        mostrarCodigo('async function obtenerDatos() {');
        mostrarCodigo('    const promesa = new Promise(res => setTimeout(() => res("Datos"), 1000));');
        mostrarCodigo('    const resultado = await promesa;');
        mostrarCodigo('    return resultado;');
        mostrarCodigo('}');
        async function obtenerDatos() {
            const promesa = new Promise(res => setTimeout(() => res("Datos"), 1000));
            const resultado = await promesa;
            return resultado;
        }
        obtenerDatos().then(res => mostrarResultado('Recibido: ' + res));

        // EJEMPLO 3
        iniciarEjemplo("try/catch para manejar errores");
        mostrarCodigo('async function conError() {');
        mostrarCodigo('    try {');
        mostrarCodigo('        const res = await Promise.reject("Error");');
        mostrarCodigo('    } catch(error) {');
        mostrarCodigo('        console.log("Capturado:", error);');
        mostrarCodigo('    }');
        mostrarCodigo('}');
        async function conError() {
            try {
                const res = await Promise.reject("Error");
            } catch(error) {
                mostrarResultado('Error capturado: ' + error);
            }
        }
        conError();

        // EJEMPLO 4
        iniciarEjemplo("Secuencial vs Paralelo");
        mostrarCodigo('// Secuencial (lento):');
        mostrarCodigo('const a = await promesa1();');
        mostrarCodigo('const b = await promesa2();');
        mostrarCodigo('');
        mostrarCodigo('// Paralelo (r√°pido):');
        mostrarCodigo('const [a, b] = await Promise.all([promesa1(), promesa2()]);');
        mostrar('');
        mostrar('üí° Usa Promise.all() para ejecuci√≥n paralela');

        // EJEMPLO 5
        iniciarEjemplo("Caso pr√°ctico - M√∫ltiples await");
        mostrarCodigo('async function procesarUsuario() {');
        mostrarCodigo('    const usuario = await obtenerUsuario();');
        mostrarCodigo('    const posts = await obtenerPosts(usuario.id);');
        mostrarCodigo('    return {usuario, posts};');
        mostrarCodigo('}');
        async function procesarUsuario() {
            const usuario = await Promise.resolve({id: 1, nombre: "Ana"});
            const posts = await Promise.resolve(["Post 1", "Post 2"]);
            return {usuario, posts};
        }
        procesarUsuario().then(data => 
            mostrarResultado('Usuario: ' + data.usuario.nombre + ', Posts: ' + data.posts.length)
        );

        // EJEMPLO 6
        iniciarEjemplo("await en bucles");
        mostrarCodigo('async function procesarLista() {');
        mostrarCodigo('    const ids = [1, 2, 3];');
        mostrarCodigo('    for (const id of ids) {');
        mostrarCodigo('        const dato = await obtenerDato(id);');
        mostrarCodigo('        console.log(dato);');
        mostrarCodigo('    }');
        mostrarCodigo('}');
        async function procesarLista() {
            const ids = [1, 2, 3];
            for (const id of ids) {
                const dato = await Promise.resolve('Dato ' + id);
                mostrarResultado(dato);
            }
        }
        procesarLista();
    </script>

    <div class="code-section">
        <h2>üìã Resumen</h2>
        <ul>
            <li>‚úÖ <code>async</code> declara funci√≥n que retorna Promise</li>
            <li>‚úÖ <code>await</code> pausa hasta que la Promise se resuelva</li>
            <li>‚úÖ Usa <code>try/catch</code> para errores</li>
            <li>‚úÖ <code>Promise.all()</code> para ejecuci√≥n paralela</li>
            <li>‚úÖ C√≥digo m√°s limpio que .then()/.catch()</li>
        </ul>
    </div>
</body>
</html>
