<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>35 - Promises</title>
    <link rel="stylesheet" href="../fundamentos/styles.css">
</head>
<body>
    <a href="../JavaScriptCami.html" class="back">â† Volver al menÃº</a>
    <h1>35 - Promises (Promesas)</h1>
    
    <div class="code-section">
        <h2>ğŸ“Œ Â¿QuÃ© es una Promise?</h2>
        <p>Una Promise es un objeto que representa el resultado eventual de una operaciÃ³n asÃ­ncrona.</p>
        <p>Estados: <code>pending</code> â†’ <code>fulfilled</code> o <code>rejected</code></p>
    </div>

    <h2>ğŸ’» Ejemplos PrÃ¡cticos</h2>
    <div id="ejemplos"></div>

    <script>
        let ejemploNumero = 0;
        const ejemplosContainer = document.getElementById('ejemplos');

        function iniciarEjemplo(titulo) {
            ejemploNumero++;
            const div = document.createElement('div');
            div.className = 'ejemplo-box';
            div.id = 'ejemplo-' + ejemploNumero;
            div.innerHTML = `<div class="ejemplo-header"><span class="ejemplo-numero">ğŸ“Œ EJEMPLO ${ejemploNumero}</span><span class="ejemplo-titulo">${titulo}</span></div><div class="ejemplo-contenido"></div>`;
            ejemplosContainer.appendChild(div);
        }

        function mostrar(texto) {
            const ejemploActual = document.getElementById('ejemplo-' + ejemploNumero);
            if (ejemploActual) {
                const contenido = ejemploActual.querySelector('.ejemplo-contenido');
                const linea = document.createElement('div');
                linea.style.cssText = 'color: #666; padding: 5px 0';
                linea.textContent = texto;
                contenido.appendChild(linea);
            }
        }

        function mostrarCodigo(codigo) {
            const ejemploActual = document.getElementById('ejemplo-' + ejemploNumero);
            if (ejemploActual) {
                const contenido = ejemploActual.querySelector('.ejemplo-contenido');
                const codigoDiv = document.createElement('div');
                codigoDiv.style.cssText = 'background: #282c34; color: #61dafb; padding: 12px; border-radius: 5px; font-family: Courier New; margin: 8px 0; border-left: 4px solid #f7df1e';
                codigoDiv.textContent = codigo;
                contenido.appendChild(codigoDiv);
            }
        }

        function mostrarResultado(texto) {
            const ejemploActual = document.getElementById('ejemplo-' + ejemploNumero);
            if (ejemploActual) {
                const contenido = ejemploActual.querySelector('.ejemplo-contenido');
                const linea = document.createElement('div');
                linea.style.cssText = 'color: #2ecc71; padding: 8px 15px; background: #e8f8f5; border-left: 4px solid #2ecc71; margin: 5px 0; border-radius: 3px; font-weight: 500; font-family: Courier New';
                linea.textContent = 'âœ ' + texto;
                contenido.appendChild(linea);
            }
        }

        const style = document.createElement('style');
        style.textContent = `.ejemplo-box {background: white;border: 2px solid #f7df1e;border-radius: 8px;margin: 20px 0;overflow: hidden;box-shadow: 0 2px 8px rgba(0,0,0,0.1);}.ejemplo-header {background: linear-gradient(135deg, #f7df1e 0%, #e5ca00 100%);padding: 15px 20px;font-weight: bold;display: flex;align-items: center;gap: 15px;}.ejemplo-numero {background: #333;color: #f7df1e;padding: 5px 15px;border-radius: 20px;font-size: 0.9em;}.ejemplo-titulo {color: #333;font-size: 1.1em;}.ejemplo-contenido {padding: 20px;background: #f9f9f9;}`;
        document.head.appendChild(style);

        // EJEMPLO 1
        iniciarEjemplo("Crear una Promise simple");
        mostrarCodigo('const promesa = new Promise((resolve, reject) => {');
        mostrarCodigo('    setTimeout(() => resolve("Â¡Ã‰xito!"), 1000);');
        mostrarCodigo('});');
        mostrarCodigo('promesa.then(resultado => console.log(resultado));');
        const promesa = new Promise((resolve, reject) => {
            setTimeout(() => resolve("Â¡Ã‰xito!"), 1000);
        });
        promesa.then(resultado => mostrarResultado(resultado));

        // EJEMPLO 2
        iniciarEjemplo("Promise con reject");
        mostrarCodigo('const promesaError = new Promise((resolve, reject) => {');
        mostrarCodigo('    const exito = false;');
        mostrarCodigo('    if (exito) resolve("OK");');
        mostrarCodigo('    else reject("Error");');
        mostrarCodigo('});');
        const promesaError = new Promise((resolve, reject) => {
            const exito = false;
            if (exito) resolve("OK");
            else reject("Error");
        });
        promesaError
            .then(res => mostrarResultado(res))
            .catch(err => mostrarResultado('Error capturado: ' + err));

        // EJEMPLO 3
        iniciarEjemplo("Encadenar Promises");
        mostrarCodigo('Promise.resolve(5)');
        mostrarCodigo('    .then(num => num * 2)');
        mostrarCodigo('    .then(num => num + 10)');
        mostrarCodigo('    .then(num => console.log(num));');
        Promise.resolve(5)
            .then(num => num * 2)
            .then(num => num + 10)
            .then(num => mostrarResultado('Resultado: ' + num));

        // EJEMPLO 4
        iniciarEjemplo("Promise.all() - Ejecutar mÃºltiples en paralelo");
        mostrarCodigo('const p1 = Promise.resolve(1);');
        mostrarCodigo('const p2 = Promise.resolve(2);');
        mostrarCodigo('const p3 = Promise.resolve(3);');
        mostrarCodigo('Promise.all([p1, p2, p3]).then(valores => console.log(valores));');
        const p1 = Promise.resolve(1);
        const p2 = Promise.resolve(2);
        const p3 = Promise.resolve(3);
        Promise.all([p1, p2, p3]).then(valores => 
            mostrarResultado('Todos completados: ' + JSON.stringify(valores))
        );

        // EJEMPLO 5
        iniciarEjemplo("Promise.race() - La primera que termine");
        mostrarCodigo('const lenta = new Promise(res => setTimeout(() => res("lenta"), 2000));');
        mostrarCodigo('const rapida = new Promise(res => setTimeout(() => res("rÃ¡pida"), 500));');
        mostrarCodigo('Promise.race([lenta, rapida]).then(res => console.log(res));');
        const lenta = new Promise(res => setTimeout(() => res("lenta"), 2000));
        const rapida = new Promise(res => setTimeout(() => res("rÃ¡pida"), 500));
        Promise.race([lenta, rapida]).then(res => 
            mostrarResultado('GanÃ³: ' + res)
        );

        // EJEMPLO 6
        iniciarEjemplo("Caso prÃ¡ctico - Simular API");
        mostrarCodigo('function obtenerUsuario(id) {');
        mostrarCodigo('    return new Promise((resolve, reject) => {');
        mostrarCodigo('        setTimeout(() => {');
        mostrarCodigo('            if (id > 0) resolve({id, nombre: "Ana"});');
        mostrarCodigo('            else reject("ID invÃ¡lido");');
        mostrarCodigo('        }, 500);');
        mostrarCodigo('    });');
        mostrarCodigo('}');
        function obtenerUsuario(id) {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    if (id > 0) resolve({id, nombre: "Ana"});
                    else reject("ID invÃ¡lido");
                }, 500);
            });
        }
        obtenerUsuario(1)
            .then(usuario => mostrarResultado('Usuario: ' + usuario.nombre))
            .catch(error => mostrarResultado('Error: ' + error));
    </script>

    <div class="code-section">
        <h2>ğŸ“‹ MÃ©todos Promise</h2>
        <ul>
            <li><code>Promise.resolve(valor)</code> - Crea promise resuelta</li>
            <li><code>Promise.reject(error)</code> - Crea promise rechazada</li>
            <li><code>Promise.all([...])</code> - Espera todas (falla si una falla)</li>
            <li><code>Promise.race([...])</code> - La primera que termine</li>
            <li><code>Promise.allSettled([...])</code> - Espera todas (no falla)</li>
        </ul>
    </div>
</body>
</html>
