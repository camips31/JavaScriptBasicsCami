<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>44 - Proxies</title>
    <link rel="stylesheet" href="../fundamentos/styles.css">
</head>
<body>
    <a href="../basicos.html" class="back">‚Üê Volver al men√∫</a>
    <h1>44 - Proxies</h1>
    
    <div class="code-section">
        <h2>üìå ¬øQu√© es un Proxy?</h2>
        <p>Un Proxy intercepta y personaliza operaciones sobre objetos (lectura, escritura, eliminaci√≥n, etc.).</p>
    </div>

    <h2>üíª Ejemplos Pr√°cticos</h2>
    <div id="ejemplos"></div>

    <script>
        let ejemploNumero = 0;
        const ejemplosContainer = document.getElementById('ejemplos');

        function iniciarEjemplo(titulo) {
            ejemploNumero++;
            const div = document.createElement('div');
            div.className = 'ejemplo-box';
            div.id = 'ejemplo-' + ejemploNumero;
            div.innerHTML = `<div class="ejemplo-header"><span class="ejemplo-numero">üìå EJEMPLO ${ejemploNumero}</span><span class="ejemplo-titulo">${titulo}</span></div><div class="ejemplo-contenido"></div>`;
            ejemplosContainer.appendChild(div);
        }

        function mostrarCodigo(codigo) {
            const ejemploActual = document.getElementById('ejemplo-' + ejemploNumero);
            if (ejemploActual) {
                const contenido = ejemploActual.querySelector('.ejemplo-contenido');
                const codigoDiv = document.createElement('div');
                codigoDiv.style.cssText = 'background: #282c34; color: #61dafb; padding: 12px; border-radius: 5px; font-family: Courier New; margin: 8px 0; border-left: 4px solid #f7df1e';
                codigoDiv.textContent = codigo;
                contenido.appendChild(codigoDiv);
            }
        }

        function mostrarResultado(texto) {
            const ejemploActual = document.getElementById('ejemplo-' + ejemploNumero);
            if (ejemploActual) {
                const contenido = ejemploActual.querySelector('.ejemplo-contenido');
                const linea = document.createElement('div');
                linea.style.cssText = 'color: #2ecc71; padding: 8px 15px; background: #e8f8f5; border-left: 4px solid #2ecc71; margin: 5px 0; border-radius: 3px; font-weight: 500; font-family: Courier New';
                linea.textContent = '‚ûú ' + texto;
                contenido.appendChild(linea);
            }
        }

        function mostrar(texto) {
            const ejemploActual = document.getElementById('ejemplo-' + ejemploNumero);
            if (ejemploActual) {
                const contenido = ejemploActual.querySelector('.ejemplo-contenido');
                const linea = document.createElement('div');
                linea.style.cssText = 'color: #666; padding: 5px 0';
                linea.textContent = texto;
                contenido.appendChild(linea);
            }
        }

        const style = document.createElement('style');
        style.textContent = `.ejemplo-box {background: white;border: 2px solid #f7df1e;border-radius: 8px;margin: 20px 0;overflow: hidden;box-shadow: 0 2px 8px rgba(0,0,0,0.1);}.ejemplo-header {background: linear-gradient(135deg, #f7df1e 0%, #e5ca00 100%);padding: 15px 20px;font-weight: bold;display: flex;align-items: center;gap: 15px;}.ejemplo-numero {background: #333;color: #f7df1e;padding: 5px 15px;border-radius: 20px;font-size: 0.9em;}.ejemplo-titulo {color: #333;font-size: 1.1em;}.ejemplo-contenido {padding: 20px;background: #f9f9f9;}`;
        document.head.appendChild(style);

        // EJEMPLO 1
        iniciarEjemplo("Proxy b√°sico - interceptar get");
        mostrarCodigo('const obj = {nombre: "Ana"};');
        mostrarCodigo('const proxy = new Proxy(obj, {');
        mostrarCodigo('    get(target, prop) {');
        mostrarCodigo('        return `Valor: ${target[prop]}`;');
        mostrarCodigo('    }');
        mostrarCodigo('});');
        const obj = {nombre: "Ana"};
        const proxy = new Proxy(obj, {
            get(target, prop) {
                return `Valor: ${target[prop]}`;
            }
        });
        mostrarResultado('proxy.nombre: ' + proxy.nombre);

        // EJEMPLO 2
        iniciarEjemplo("Validaci√≥n con set");
        mostrarCodigo('const usuario = new Proxy({}, {');
        mostrarCodigo('    set(target, prop, valor) {');
        mostrarCodigo('        if (prop === "edad" && valor < 0) {');
        mostrarCodigo('            throw Error("Edad inv√°lida");');
        mostrarCodigo('        }');
        mostrarCodigo('        target[prop] = valor;');
        mostrarCodigo('    }');
        mostrarCodigo('});');
        const usuario = new Proxy({}, {
            set(target, prop, valor) {
                if (prop === "edad" && valor < 0) {
                    mostrarResultado('‚ùå Error: Edad inv√°lida');
                    return false;
                }
                target[prop] = valor;
                mostrarResultado('‚úÖ ' + prop + ' = ' + valor);
                return true;
            }
        });
        usuario.edad = 25;
        usuario.edad = -5;

        // EJEMPLO 3
        iniciarEjemplo("Propiedades inexistentes");
        mostrarCodigo('const obj = new Proxy({}, {');
        mostrarCodigo('    get(target, prop) {');
        mostrarCodigo('        return prop in target ? target[prop] : "No existe";');
        mostrarCodigo('    }');
        mostrarCodigo('});');
        const objDefecto = new Proxy({nombre: "Juan"}, {
            get(target, prop) {
                return prop in target ? target[prop] : "No existe";
            }
        });
        mostrarResultado('objDefecto.nombre: ' + objDefecto.nombre);
        mostrarResultado('objDefecto.edad: ' + objDefecto.edad);

        // EJEMPLO 4
        iniciarEjemplo("Logging autom√°tico");
        mostrarCodigo('const logger = new Proxy({}, {');
        mostrarCodigo('    get(target, prop) {');
        mostrarCodigo('        console.log(`Accediendo a ${prop}`);');
        mostrarCodigo('        return target[prop];');
        mostrarCodigo('    }');
        mostrarCodigo('});');
        const logger = new Proxy({api: "https://api.com"}, {
            get(target, prop) {
                mostrarResultado('üìù Log: Accediendo a ' + prop);
                return target[prop];
            }
        });
        logger.api;

        // EJEMPLO 5
        iniciarEjemplo("Arrays negativos (estilo Python)");
        mostrarCodigo('function arrayNegativo(arr) {');
        mostrarCodigo('    return new Proxy(arr, {');
        mostrarCodigo('        get(target, prop) {');
        mostrarCodigo('            const index = Number(prop);');
        mostrarCodigo('            if (index < 0) return target[target.length + index];');
        mostrarCodigo('            return target[prop];');
        mostrarCodigo('        }');
        mostrarCodigo('    });');
        mostrarCodigo('}');
        function arrayNegativo(arr) {
            return new Proxy(arr, {
                get(target, prop) {
                    const index = Number(prop);
                    if (index < 0) return target[target.length + index];
                    return target[prop];
                }
            });
        }
        const arr = arrayNegativo([1, 2, 3, 4, 5]);
        mostrarResultado('arr[-1]: ' + arr[-1]);
        mostrarResultado('arr[-2]: ' + arr[-2]);

        // EJEMPLO 6
        iniciarEjemplo("Revocable Proxy");
        mostrarCodigo('const {proxy, revoke} = Proxy.revocable({}, {});');
        mostrarCodigo('proxy.nombre = "Ana"; // OK');
        mostrarCodigo('revoke();');
        mostrarCodigo('proxy.edad = 25; // Error!');
        const {proxy: revocableProxy, revoke} = Proxy.revocable({}, {});
        revocableProxy.nombre = "Ana";
        mostrarResultado('‚úÖ Proxy funciona');
        revoke();
        mostrarResultado('üîí Proxy revocado');
    </script>

    <div class="code-section">
        <h2>üìã Traps principales</h2>
        <ul>
            <li><code>get(target, prop)</code> - Lectura</li>
            <li><code>set(target, prop, valor)</code> - Escritura</li>
            <li><code>has(target, prop)</code> - Operador in</li>
            <li><code>deleteProperty(target, prop)</code> - delete</li>
            <li><code>apply(target, thisArg, args)</code> - Llamada a funci√≥n</li>
        </ul>
    </div>
</body>
</html>
